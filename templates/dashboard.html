<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Homepage-Staff</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="navbar">
  <div class="navbar-left">
    <h1>ezStay</h1>
  </div>

  <div class="nav-links">
    {% if role == "admin" %}
      <a href="/users">Authorized Users</a>
    {% elif role == "manager" %}
      <a href="/rooms">Rooms</a>
      <a href="/services">Services</a>
      <a href="/guests">Guests</a>
      <a href="/staff">Staff</a>
      <a href="/bookings">Bookings</a>
      <a href="/roomGuest">Check-in/Checkout</a>  
      <a href="/requests">Requests</a>
    {% elif role == "supervisor" or role == "staff" %}
      <a href="/requests">Requests</a>
    {% endif %}
  </div>

  <div class="dropdown">
    <img src="{{ url_for('static', filename='images/profile-icon.svg') }}" alt="Profile" class="profile-icon" onclick="toggleDropdown()">
    <div id="dropdownMenu" class="dropdown-menu">
      <a href="{{ url_for('profile') }}">Profile</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>
</div>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="alert alert-success mt-3 text-center">
      {{ messages[0] }}
    </div>
  {% endif %}
{% endwith %}

  <section class="stats-box">
    <table>
    <tr><td>Housekeeping</td><td>{{ stats.housekeeping }}</td></tr>
    <tr><td>Food</td><td>{{ stats.food }}</td></tr>
    <tr><td>Laundry</td><td>{{ stats.laundry }}</td></tr>
    <tr><td>Spa</td><td>{{ stats.spa }}</td></tr>
  </table>
  </section>
  <section class="chart-section">
    <div style="width: 400px; margin: 0 auto;">
        <!-- Bar Chart -->
        <canvas id="barChart"></canvas>
    </div>
    <h2 style="text-align:center; margin-top: 30px;">Daily Staff Activity</h2>
    <div style="width: 400px; margin: 0 auto;">
        <!-- Pie Chart -->
        <canvas id="pieChart"></canvas>
    </div>
  </section>

  <script>
  // Bar Chart Data
  const barLabels = [{% for staff in staff_data %}"{{ staff.staff }}"{% if not loop.last %}, {% endif %}{% endfor %}];
  const requestsData = [{% for staff in staff_data %}{{ staff.requests }}{% if not loop.last %}, {% endif %}{% endfor %}];
  const completedData = [{% for staff in staff_data %}{{ staff.completed }}{% if not loop.last %}, {% endif %}{% endfor %}];

  new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
          labels: barLabels,
          datasets: [
              {
                  label: 'Requests',
                  backgroundColor: '#7fd3f7',
                  data: requestsData
              },
              {
                  label: 'Completed',
                  backgroundColor: '#ff8c6b',
                  data: completedData
              }
          ]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: true }
          },
          scales: {
              x: { stacked: false },
              y: { beginAtZero: true }
          }
      }
  });

  // Pie Chart Data
  const pieLabels = [{% for s in service_data %}"{{ s.service_type }}"{% if not loop.last %}, {% endif %}{% endfor %}];
  const pieData = [{% for s in service_data %}{{ s.count }}{% if not loop.last %}, {% endif %}{% endfor %}];
  const pieColors = ['#5fd3bc', '#7fd3f7', '#8cb6e6', '#b3b3c6', '#f7c873'];

  new Chart(document.getElementById('pieChart'), {
      type: 'pie',
      data: {
          labels: pieLabels,
          datasets: [{
              data: pieData,
              backgroundColor: pieColors
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: true, position: 'bottom' }
          }
      }
  });

function toggleDropdown() {
  var menu = document.getElementById("dropdownMenu");
  menu.style.display = (menu.style.display === "block") ? "none" : "block";
}

// Optional: Close dropdown if clicking outside
window.onclick = function(event) {
  if (!event.target.matches('.profile-icon')) {
    var dropdowns = document.getElementsByClassName("dropdown-menu");
    for (var i = 0; i < dropdowns.length; i++) {
      dropdowns[i].style.display = "none";
    }
  }
}
  </script>
</body>
</html>
